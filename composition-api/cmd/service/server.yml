openapi: 3.0.0
info:
  title: API med_ml сервера
  description: API для сервера med_ml
  version: "v0.0.1"
servers:
  - url: http://localhost:8080/api/v1
    description: Local development server

components:
  schemas:
    device:
      type: object
      description: узи аппарат
      required:
        - id
        - name
      properties:
        id:
          type: integer
          description: id устройства
        name:
          type: string
          maxLength: 255
          description: название устройства
      example:
        id: 1
        name: "ульпанатор 3000"

    uzi:
      type: object
      description: узи
      required:
        - id
        - projection
        - checked
        - external_id
        - author_id
        - device_id
        - status
        - create_at
      properties:
        id:
          type: string
          format: uuid
          description: id узи
        projection:
          type: string
          enum:
            - cross
            - long
          description: проекция узи
          maxLength: 255
        checked:
          type: boolean
          description: проверенно ли врачем
        external_id:
          type: string
          format: uuid
          description: id пациента/организации etc. Внешняя связсь
        author_id:
          type: string
          format: uuid
          description: id аккаунта, загрузившего узи
        device_id:
          type: integer
          description: id устройства
        status:
          type: string
          enum:
            - new
            - pending
            - completed
          description: >
            Статус узи
            **new** - новое узи
            **pending** - в обработке нейронкой
            **completed** - обработано
        create_at:
          type: string
          format: date-time
          description: дата создания в формате RFC3339
      example:
        id: "123e4567-e89b-12d3-a456-426614174000"
        projection: "cross"
        checked: false
        external_id: "123e4567-e89b-12d3-a456-426614174000"
        author_id: "123e4567-e89b-12d3-a456-426614174000"
        device_id: 1
        status: "pending"
        create_at: "2021-01-01T00:00:00Z" # RFC3339

    echographics:
      type: object
      description: эхографическая информация
      required:
        - id
      properties:
        id:
          type: string
          format: uuid
          description: id узи
        contors:
          type: string
          description: контуры
          maxLength: 255
        left_lobe_length:
          type: number
          description: длина левого доли
        left_lobe_width:
          type: number
          description: ширина левого доли
        left_lobe_thick:
          type: number
          description: толщина левого доли
        left_lobe_volum:
          type: number
          description: объем левого доли
        right_lobe_length:
          type: number
          description: длина правого доли
        right_lobe_width:
          type: number
          description: ширина правого доли
        right_lobe_thick:
          type: number
          description: толщина правого доли
        right_lobe_volum:
          type: number
          description: объем правого доли
        gland_volum:
          type: number
          description: объем железы
        isthmus:
          type: number
          description: перешеек
        struct:
          type: string
          description: структура
          maxLength: 255
        echogenicity:
          type: string
          description: эхогенность
          maxLength: 255
        regional_lymph:
          type: string
          description: регионарные лимфоузлы
          maxLength: 255
        vascularization:
          type: string
          description: васкуляризация по ЦДК
          maxLength: 255
        location:
          type: string
          description: расположение
          maxLength: 255
        additional:
          type: string
          description: дополнительная информация
          maxLength: 255
        conclusion:
          type: string
          description: заключение
          maxLength: 255
      example:
        id: "123e4567-e89b-12d3-a456-426614174000"
        contors: "контуры"
        left_lobe_length: 100
        left_lobe_width: 100
        left_lobe_thick: 100
        left_lobe_volum: 100
        right_lobe_length: 100
        right_lobe_width: 100
        right_lobe_thick: 100
        right_lobe_volum: 100
        gland_volum: 100
        isthmus: 100
        struct: "квадрат"
        echogenicity: "эхогенность"
        regional_lymph: "в правой части"
        vascularization: "выраженная"
        location: "в правой части"
        additional: "видны последстввия нездорового образа жизни"
        conclusion: "требуется лечение"

    node:
      type: object
      description: узел
      required:
        - id
        - ai
        - uzi_id
        - tirads_23
        - tirads_4
        - tirads_5
      properties:
        id:
          type: string
          format: uuid
          description: id узла
        ai:
          type: boolean
          description: признак того, что узел был создан нейронкой
        uzi_id:
          type: string
          format: uuid
          description: id узи, к которому относится узел
        validation:
          type: string
          enum:
            - null
            - invalid
            - valid
          description: валидация нейроночного узла врачем
        tirads_23:
          type: number
          maximum: 1.0
          minimum: 0.0
          description: вероятность наличия опухоли в 23-й группе
        tirads_4:
          type: number
          maximum: 1.0
          minimum: 0.0
          description: вероятность наличия опухоли в 4-й группе
        tirads_5:
          type: number
          maximum: 1.0
          minimum: 0.0
          description: вероятность наличия опухоли в 5-й группе
        description:
          type: string
          description: описание узла
      example:
        id: "123e4567-e89b-12d3-a456-426614174000"
        ai: true
        uzi_id: "123e4567-e89b-12d3-a456-426614174000"
        validation: "invalid"
        tirads_23: 0.67
        tirads_4: 0.23
        tirads_5: 0.89
        description: "узел явно неправильный"

    contor:
      type: array
      description: контур сегмента в формате json
      items:
        type: object
        required:
          - x
          - y
        properties:
          x:
            type: integer
            minimum: 0
            description: x координата точки
          y:
            type: integer
            minimum: 0
            description: y координата точки
      example:
        - x: 100
          y: 100
        - x: 200
          y: 200

    segment:
      type: object
      description: сегмент узла на изображении
      required:
        - id
        - image_id
        - node_id
        - contor
        - ai
        - tirads_23
        - tirads_4
        - tirads_5
      properties:
        id:
          type: string
          format: uuid
          description: id сегмента
        image_id:
          type: string
          format: uuid
          description: id изображения, к которому относится сегмент
        node_id:
          type: string
          format: uuid
          description: id узла, к которому относится сегмент
        contor:
          $ref: '#/components/schemas/contor'
          description: контур сегмента
        ai:
          type: boolean
          description: признак того, что сегмент был создан нейронкой
        tirads_23:
          type: number
          maximum: 1.0
          minimum: 0.0
          description: вероятность наличия опухоли в 23-й группе
        tirads_4:
          type: number
          maximum: 1.0
          minimum: 0.0
          description: вероятность наличия опухоли в 4-й группе
        tirads_5:
          type: number
          maximum: 1.0
          minimum: 0.0
          description: вероятность наличия опухоли в 5-й группе
      example:
        id: "123e4567-e89b-12d3-a456-426614174000"
        image_id: "123e4567-e89b-12d3-a456-426614174000"
        node_id: "123e4567-e89b-12d3-a456-426614174000"
        contor:
          - x: 100
            y: 100
          - x: 200
            y: 200
        ai: false
        tirads_23: 0.45
        tirads_4: 0.78
        tirads_5: 0.12

    image:
      type: object
      description: изображение
      required:
        - id
        - uzi_id
        - page
      properties:
        id:
          type: string
          format: uuid
          description: id изображения
        uzi_id:
          type: string
          format: uuid
          description: id узи, к которому относится изображение
        page:
          type: integer
          description: номер страницы
      example:
        id: "123e4567-e89b-12d3-a456-426614174000"
        uzi_id: "123e4567-e89b-12d3-a456-426614174000"
        page: 1

    doctor:
      type: object
      description: врач
      required:
        - id
        - fullname
        - org
        - job
      properties:
        id:
          type: string
          format: uuid
          description: id врача
        fullname:
          type: string
          maxLength: 255
          description: полное имя врача
        org:
          type: string
          maxLength: 255
          description: организация врача
        job:
          type: string
          maxLength: 255
          description: работа врача
        description:
          type: string
          description: описание врача (раб. стаж)
      example:
        id: "123e4567-e89b-12d3-a456-426614174000"
        fullname: "Иван Иванов"
        org: "Медицинский центр"
        job: "Хирург"
        description: "работает в медицинском центре с 2010 года"

    patient:
      type: object
      description: пациент
      required:
        - id
        - fullname
        - email
        - policy
        - active
        - malignancy
        - birth_date
      properties:
        id:
          type: string
          format: uuid
          description: id пациента
        fullname:
          type: string
          maxLength: 255
          description: полное имя пациента
        email:
          type: string
          maxLength: 255
          description: email пациента
        policy:
          type: string
          maxLength: 255
          description: полис пациента
        active:
          type: boolean
          description: признак того, что пациент активен
        malignancy:
          type: boolean
          description: признак того, что пациент имеет злокачественную опухоль
        birth_date:
          type: string
          format: date
          description: дата рождения пациента
        last_uzi_date:
          type: string
          format: date
          description: дата последнего узи
      example:
        id: "123e4567-e89b-12d3-a456-426614174000"
        fullname: "Иван Иванов"
        email: "ivan@example.com"
        policy: "1234567890"
        active: true
        malignancy: false
        birth_date: "2021-01-01"
        last_uzi_date: "2024-01-01"

    card:
      type: object
      description: карта пациента
      required:
        - patient_id
        - doctor_id
      properties:
        patient_id:
          type: string
          format: uuid
          description: id пациента
        doctor_id:
          type: string
          format: uuid
          description: id врача
        diagnosis:
          type: string
          description: диагноз
      example:
        patient_id: "123e4567-e89b-12d3-a456-426614174000"
        doctor_id: "123e4567-e89b-12d3-a456-426614174000"
        diagnosis: "опухоль"

    patientCard:
      type: object
      description: карта пациента
      properties:
        id:
          type: integer
          readOnly: true
        acceptance_datetime:
          type: string
          format: date-time
          readOnly: true
        diagnosis:
          type: string
        patient:
          type: integer
          x-nullable: true
        med_worker:
          type: integer
          x-nullable: true

    simpleUuid:
      type: object
      description: uuid
      required:
        - id
      properties:
        id:
          type: string
          format: uuid
      example:
        id: "123e4567-e89b-12d3-a456-426614174000"

    TariffPlan:
      type: object
      description: Тарифный план
      required:
        - id
        - name
        - description
        - price
        - duration
      properties:
        id:
          type: string
          format: uuid
          description: Идентификатор тарифного плана
        name:
          type: string
          description: Название тарифного плана
        description:
          type: string
          description: Описание тарифного плана
        price:
          type: string
          description: Цена тарифного плана
        duration:
          type: integer
          description: Длительность тарифного плана в наносекундах
      example:
        id: "123e4567-e89b-12d3-a456-426614174000"
        name: "Basic Plan"
        description: "This is a basic tariff plan."
        price: "9.99"
        duration: 2592000000000000  # 30 дней в наносекундах

    Subscription:
      type: object
      description: Подписка
      required:
        - id
        - tariff_plan_id
        - status
        - start_date
        - end_date
      properties:
        id:
          type: string
          format: uuid
          description: Идентификатор подписки
        tariff_plan_id:
          type: string
          format: uuid
          description: Идентификатор тарифного плана
        status:
          type: string
          enum: [pending_payment, active, cancelled ]
          description: Статус подписки
        start_date:
          type: string
          format: date-time
          description: Дата начала подписки
        end_date:
          type: string
          format: date-time
          description: Дата окончания подписки
      example:
        id: "123e4567-e89b-12d3-a456-426614174000"
        tariff_plan_id: "123e4567-e89b-12d3-a456-426614174000"
        status: "active"
        start_date: "2023-01-01T00:00:00Z"
        end_date: "2023-12-31T23:59:59Z"

    PurchaseSubscriptionRequest:
      type: object
      description: Запрос на покупку подписки
      required:
        - tariff_plan_id
        - payment_provider_id
      properties:
        tariff_plan_id:
          type: string
          format: uuid
          description: Идентификатор тарифного плана
        payment_provider_id:
          type: string
          format: uuid
          description: Идентификатор провайдера платежей
      example:
        tariff_plan_id: "123e4567-e89b-12d3-a456-426614174000"
        payment_provider_id: "123e4567-e89b-12d3-a456-426614174000"

    PurchaseSubscriptionResponse:
      type: object
      description: Ответ на покупку подписки
      required:
        - subscription_id
        - confirmation_url
      properties:
        subscription_id:
          type: string
          format: uuid
          description: Идентификатор подписки
        confirmation_url:
          type: string
          description: URL для подтверждения подписки
      example:
        subscription_id: "123e4567-e89b-12d3-a456-426614174000"
        confirmation_url: "https://example.com/confirm"

    YookassaWebhookRequest:
      type: object
      description: Запрос вебхука от Юкассы
      properties:
        type:
          type: string
          description: Тип уведомления
        event:
          type: string
          description: Событие, связанное с уведомлением
        object:
          type: object
          description: Объект уведомления
          properties:
            id:
              type: string
              format: uuid
              description: Идентификатор платежа
            status:
              type: string
              description: Статус платежа
            paid:
              type: boolean
              description: Был ли платеж оплачен
            amount:
              type: object
              description: Сумма платежа
              properties:
                value:
                  type: string
                  description: Сумма
                currency:
                  type: string
                  description: Валюта
            created_at:
              type: string
              format: date-time
              description: Дата и время создания платежа
            description:
              type: string
              description: Описание платежа
            expires_at:
              type: string
              format: date-time
              description: Дата и время истечения платежа
            metadata:
              type: object
              description: Дополнительные данные
            payment_method:
              type: object
              description: Метод оплаты
              properties:
                type:
                  type: string
                  description: Тип метода оплаты
                id:
                  type: string
                  format: uuid
                  description: Идентификатор метода оплаты
                saved:
                  type: boolean
                  description: Был ли метод оплаты сохранен
                card:
                  type: object
                  description: Информация о карте
                  properties:
                    first6:
                      type: string
                      description: Первые 6 цифр карты
                    last4:
                      type: string
                      description: Последние 4 цифры карты
                    expiry_month:
                      type: string
                      description: Месяц истечения срока действия карты
                    expiry_year:
                      type: string
                      description: Год истечения срока действия карты
                    card_type:
                      type: string
                      description: Тип карты
                    issuer_country:
                      type: string
                      description: Страна эмитента карты
                    issuer_name:
                      type: string
                      description: Имя эмитента карты
            refundable:
              type: boolean
              description: Возможность возврата
            test:
              type: boolean
              description: Является ли платеж тестовым
      example:
        type: "notification"
        event: "payment.waiting_for_capture"
        object:
          id: "22d6d597-000f-5000-9000-145f6df21d6f"
          status: "waiting_for_capture"
          paid: true
          amount:
            value: "2.00"
            currency: "RUB"
          created_at: "2018-07-10T14:27:54.691Z"
          description: "Заказ №72"
          expires_at: "2018-07-17T14:28:32.484Z"
          metadata: { }
          payment_method:
            type: "bank_card"
            id: "22d6d597-000f-5000-9000-145f6df21d6f"
            saved: false
            card:
              first6: "555555"
              last4: "4444"
              expiry_month: "07"
              expiry_year: "2021"
              card_type: "MasterCard"
              issuer_country: "RU"
              issuer_name: "Sberbank"
          refundable: false
          test: false

    PaymentProvider:
      type: object
      description: Платежный провайдер
      properties:
        id:
          type: string
          format: uuid
          description: Идентификатор платежного провайдера
        name:
          type: string
          description: Название платежного провайдера
        is_active:
          type: boolean
          description: Активен ли провайдер
      example:
        id: "123e4567-e89b-12d3-a456-426614174000"
        name: "Yookassa"
        is_active: true

    cytologyImage:
      type: object
      description: цитологическое исследование
      required:
        - id
        - external_id
        - doctor_id
        - patient_id
        - diagnostic_number
        - is_last
        - diagnos_date
        - create_at
      properties:
        id:
          type: string
          format: uuid
          description: id цитологического исследования
        external_id:
          type: string
          format: uuid
          description: внешний id пациента/организации etc.
        doctor_id:
          type: string
          format: uuid
          description: id врача
        patient_id:
          type: string
          format: uuid
          description: id пациента
        diagnostic_number:
          type: integer
          description: номер диагностики
        diagnostic_marking:
          type: string
          enum:
            - П11
            - Л23
          description: маркировка диагностики
        material_type:
          type: string
          enum:
            - GS
            - BP
            - TP
            - PTP
            - LNP
          description: тип материала
        diagnos_date:
          type: string
          format: date-time
          description: дата диагностики
        is_last:
          type: boolean
          description: является ли данная версия последней
        calcitonin:
          type: integer
          description: кальцитонин
        calcitonin_in_flush:
          type: integer
          description: кальцитонин в смыве
        thyroglobulin:
          type: integer
          description: тиреоглобулин
        details:
          type: object
          description: детали диагностики (JSON)
        prev_id:
          type: string
          format: uuid
          description: id предыдущей версии
        parent_prev_id:
          type: string
          format: uuid
          description: id родительской предыдущей версии
        create_at:
          type: string
          format: date-time
          description: дата создания
      example:
        id: "123e4567-e89b-12d3-a456-426614174000"
        external_id: "123e4567-e89b-12d3-a456-426614174000"
        doctor_id: "123e4567-e89b-12d3-a456-426614174000"
        patient_id: "123e4567-e89b-12d3-a456-426614174000"
        diagnostic_number: 1
        diagnostic_marking: "П11"
        material_type: "GS"
        diagnos_date: "2024-01-01T00:00:00Z"
        is_last: true
        calcitonin: 10
        calcitonin_in_flush: 5
        thyroglobulin: 20
        create_at: "2024-01-01T00:00:00Z"

    originalImage:
      type: object
      description: оригинальное изображение
      required:
        - id
        - cytology_id
        - image_path
        - create_date
        - viewed_flag
      properties:
        id:
          type: string
          format: uuid
          description: id изображения
        cytology_id:
          type: string
          format: uuid
          description: id цитологического исследования
        image_path:
          type: string
          description: путь к изображению в S3
        create_date:
          type: string
          format: date-time
          description: дата создания
        delay_time:
          type: number
          description: время обработки
        viewed_flag:
          type: boolean
          description: флаг просмотра
      example:
        id: "123e4567-e89b-12d3-a456-426614174000"
        cytology_id: "123e4567-e89b-12d3-a456-426614174000"
        image_path: "cytology/images/123e4567-e89b-12d3-a456-426614174000.png"
        create_date: "2024-01-01T00:00:00Z"
        delay_time: 1.5
        viewed_flag: false

    segmentationGroup:
      type: object
      description: группа сегментаций
      required:
        - id
        - cytology_id
        - seg_type
        - group_type
        - is_ai
        - create_at
      properties:
        id:
          type: integer
          description: id группы сегментаций
        cytology_id:
          type: string
          format: uuid
          description: id цитологического исследования
        seg_type:
          type: string
          enum:
            - NIL
            - NIR
            - NIM
            - CNO
            - CGE
            - C2N
            - CPS
            - CFC
            - CLY
            - SOS
            - SDS
            - SMS
            - STS
            - SPS
            - SNM
            - STM
          description: тип сегментации
        group_type:
          type: string
          enum:
            - CE
            - CL
            - ME
          description: тип группы
        is_ai:
          type: boolean
          description: создана ли группа AI
        details:
          type: object
          description: детали (JSON)
        create_at:
          type: string
          format: date-time
          description: дата создания
      example:
        id: 1
        cytology_id: "123e4567-e89b-12d3-a456-426614174000"
        seg_type: "NIL"
        group_type: "CE"
        is_ai: false
        create_at: "2024-01-01T00:00:00Z"

    segmentationPoint:
      type: object
      description: точка сегментации
      required:
        - x
        - y
      properties:
        x:
          type: integer
          minimum: 0
          description: координата X
        y:
          type: integer
          minimum: 0
          description: координата Y
      example:
        x: 100
        y: 200

    segmentation:
      type: object
      description: сегментация
      required:
        - id
        - segmentation_group_id
        - points
        - create_at
      properties:
        id:
          type: integer
          description: id сегментации
        segmentation_group_id:
          type: integer
          description: id группы сегментаций
        points:
          type: array
          items:
            $ref: '#/components/schemas/segmentationPoint'
          description: точки сегментации
        create_at:
          type: string
          format: date-time
          description: дата создания
      example:
        id: 1
        segmentation_group_id: 1
        points:
          - x: 100
            y: 200
          - x: 200
            y: 300
        create_at: "2024-01-01T00:00:00Z"

    error:
      description: Ошибка
      type: object
      properties:
        message:
          type: string
      required:
        - message

  responses:
    error:
      description: Ошибка
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/error"

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

security:
  - bearerAuth: []

paths:
  /login:
    post:
      summary: авторизация
      tags:
        - auth
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  maxLength: 255
                  format: email
                  description: email аккаунта
                password:
                  type: string
                  maxLength: 255
                  description: пароль аккаунта
              example:
                email: "test@test.com"
                password: "qwerty123"
      responses:
        '200':
          description: авторизация прошла успешно
          content:
            application/json:
              schema:
                type: object
                required:
                  - access_token
                  - refresh_token
                properties:
                  access_token:
                    type: string
                    format: jwt
                    description: access токен
                  refresh_token:
                    type: string
                    format: jwt
                    description: refresh токен
        '400':
          description: Неверный формат запроса
          $ref: "#/components/responses/error"
        '401':
          description: Неверный email или пароль
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /refresh:
    post:
      summary: обновить access token
      tags:
        - auth
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refresh_token
              properties:
                refresh_token:
                  type: string
                  format: jwt
                  description: refresh токен
              example:
                refresh_token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"
      responses:
        '200':
          description: новая пара access и refresh токенов
          content:
            application/json:
              schema:
                type: object
                required:
                  - access_token
                  - refresh_token
                properties:
                  access_token:
                    type: string
                    format: jwt
                    description: access токен
                  refresh_token:
                    type: string
                    format: jwt
                    description: refresh токен
        '400':
          description: Неверный формат запроса
          $ref: "#/components/responses/error"
        '401':
          description: Неверный или истекший refresh токен
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /reg/doctor:
    post:
      summary: зарегистрировать врача (как пользователя)
      tags:
        - reg
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - fullname
                - org
                - job
                - email
                - password
              properties:
                email:
                  type: string
                  maxLength: 255
                  format: email
                  description: email врача
                password:
                  type: string
                  maxLength: 255
                  description: пароль врача
                fullname:
                  type: string
                  maxLength: 255
                  description: полное имя врача
                org:
                  type: string
                  maxLength: 255
                  description: организация врача
                job:
                  type: string
                  maxLength: 255
                  description: работа врача
                description:
                  type: string
                  description: описание врача (раб. стаж)
              example:
                fullname: "Иван Иванов"
                org: "Медицинский центр"
                job: "Хирург"
                email: "test@test.com"
                password: "qwerty123"
                description: "работает в медицинском центре с 2010 года"
      responses:
        '200':
          description: врач зарегистрирован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/simpleUuid"
        '400':
          description: Неверный формат запроса
          $ref: "#/components/responses/error"
        '422':
          description: Ошибка валидации данных
          $ref: "#/components/responses/error"
        '409':
          description: Пользователь с таким email уже существует
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /reg/patient:
    post:
      summary: зарегистрировать пациента (как пользователя). **Сделано под мобилки api**. Врачам регистрировать пациентов через /med/patient
      tags:
        - reg
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - fullname
                - policy
                - birth_date
                - email
                - password
              properties:
                fullname:
                  type: string
                  maxLength: 255
                  description: полное имя пациента
                policy:
                  type: string
                  maxLength: 255
                  description: полис пациента
                birth_date:
                  type: string
                  format: date
                  description: дата рождения пациента
                email:
                  type: string
                  maxLength: 255
                  format: email
                  description: email врача
                password:
                  type: string
                  maxLength: 255
                  description: пароль врача
              example:
                fullname: "Иван Иванов"
                policy: "1234567890"
                birth_date: "2021-01-01"
                email: "test@test.com"
                password: "qwerty123"
      responses:
        '200':
          description: пациент зарегистрирован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/simpleUuid"
        '400':
          description: Неверный формат запроса
          $ref: "#/components/responses/error"
        '422':
          description: Ошибка валидации данных
          $ref: "#/components/responses/error"
        '409':
          description: Пользователь с таким email уже существует
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /med/doctor/{id}:
    get:
      summary: получить врача
      tags:
        - med
      parameters:
        - name: id
          in: path
          required: true
          description: id врача
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: врач
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/doctor"
        '404':
          description: Врач не найден
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /med/patient:
    post:
      summary: зарегистрировать пациента
      tags:
        - med

      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - fullname
                - email
                - policy
                - active
                - malignancy
                - birth_date
              properties:
                fullname:
                  type: string
                  maxLength: 255
                  description: полное имя пациента
                email:
                  type: string
                  maxLength: 255
                  format: email
                  description: email пациента
                policy:
                  type: string
                  maxLength: 255
                  description: полис пациента
                active:
                  type: boolean
                  description: признак того, что пациент активен
                malignancy:
                  type: boolean
                  description: признак того, что пациент имеет злокачественную опухоль
                birth_date:
                  type: string
                  format: date
                  description: дата рождения пациента в формате ISO 8601
      responses:
        '200':
          description: пациент зарегистрирован
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/simpleUuid"
        '400':
          description: Неверный формат запроса
          $ref: "#/components/responses/error"
        '409':
          description: Пользователь с таким email уже существует
          $ref: "#/components/responses/error"
        '422':
          description: Ошибка валидации данных
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /med/patient/{id}:
    get:
      summary: получить пациента
      tags:
        - med

      parameters:
        - name: id
          in: path
          required: true
          description: id пациента
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: пациент
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/patient"
        '404':
          description: Пациент не найден
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

    patch:
      summary: обновить пациента
      tags:
        - med

      parameters:
        - name: id
          in: path
          required: true
          description: id пациента
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                active:
                  type: boolean
                  description: признак того, что пациент активен
                malignancy:
                  type: boolean
                  description: признак того, что пациент имеет злокачественную опухоль
      responses:
        '200':
          description: пациент обновлен
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/patient"
        '404':
          description: Пациент не найден
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /med/doctor/{id}/patients:
    get:
      summary: получить пациентов врача
      tags:
        - med

      parameters:
        - name: id
          in: path
          required: true
          description: id врача
          schema:
            type: string
            format: uuid
        - name: status
          in: query
          required: false
          description: фильтр по статусу пациента (true - активные, false - неактивные)
          schema:
            type: boolean
      responses:
        '200':
          description: врач
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/patient'
        '404':
          description: Врач не найден
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /med/card:
    post:
      summary: создать карту пациента
      tags:
        - med

      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/card"
      responses:
        '200':
          description: карта пациента создана
        '400':
          description: Неверный формат запроса
          $ref: "#/components/responses/error"
        '404':
          description: Пациент не найден
          $ref: "#/components/responses/error"
        '422':
          description: Ошибка валидации данных
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /med/card/{doctor_id}/{patient_id}:
    get:
      summary: получить карту пациента
      tags:
        - med

      parameters:
        - name: doctor_id
          in: path
          required: true
          description: id врача
          schema:
            type: string
            format: uuid
        - name: patient_id
          in: path
          required: true
          description: id пациента
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: карта пациента
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/card"
        '404':
          description: Карта пациента не найдена
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

    patch:
      summary: обновить карту пациента
      tags:
        - med

      parameters:
        - name: doctor_id
          in: path
          required: true
          description: id врача
          schema:
            type: string
            format: uuid
        - name: patient_id
          in: path
          required: true
          description: id пациента
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - diagnosis
              properties:
                diagnosis:
                  type: string
                  description: диагноз пациента
      responses:
        '200':
          description: карта пациента обновлена
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/card"
        '404':
          description: Карта пациента не найдена
          $ref: "#/components/responses/error"
        '400':
          description: Неверный формат запроса
          $ref: "#/components/responses/error"
        '422':
          description: Ошибка валидации данных
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"
  /uzi:
    post:
      summary: загрузить узи на обработку
      tags:
        - uzi

      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: файл узи. **обязательно с .tiff/.png**
                projection:
                  type: string
                  enum:
                    - cross
                    - long
                  description: проекция узи
                external_id:
                  type: string
                  format: uuid
                  description: внешний id пациента/организации etc.
                device_id:
                  type: integer
                  description: id узи аппарата
                description:
                  type: string
                  description: описание узи
              required:
                - file
                - projection
                - external_id
                - device_id
      responses:
        '200':
          description: id узи
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/simpleUuid"
        '400':
          description: Неверный формат запроса или файла
          $ref: "#/components/responses/error"
        '422':
          description: Ошибка валидации данных
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /uzi/{id}:
    get:
      summary: получить узи
      tags:
        - uzi

      parameters:
        - name: id
          in: path
          required: true
          description: id узи
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: узи
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uzi"
        '404':
          description: УЗИ не найдено
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

    patch:
      summary: обновить узи
      tags:
        - uzi

      parameters:
        - name: id
          in: path
          required: true
          description: id узи
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                projection:
                  type: string
                  enum:
                    - cross
                    - long
                  description: проекция узи
                checked:
                  type: boolean
                  description: признак того, что узи проверено врачом
              example:
                projection: "cross"
                checked: true
      responses:
        '200':
          description: узи
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/uzi"
        '404':
          description: УЗИ не найдено
          $ref: "#/components/responses/error"
        '400':
          description: Неверный формат запроса
          $ref: "#/components/responses/error"
        '422':
          description: Ошибка валидации данных
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

    delete:
      summary: удалить узи
      tags:
        - uzi

      parameters:
        - name: id
          in: path
          required: true
          description: id узи
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: узи удалено
        '404':
          description: УЗИ не найдено
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /uzis/external/{id}:
    get:
      summary: получить узи по внешнему id
      tags:
        - uzi

      parameters:
        - name: id
          in: path
          required: true
          description: внешний id пациента/организации etc.
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: узи
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/uzi'
        '404':
          description: УЗИ не найдено
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /uzis/author/{id}:
    get:
      summary: получить узи по id автора
      tags:
        - uzi

      parameters:
        - name: id
          in: path
          required: true
          description: id аккаунта, загрузившего узи
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: узи
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/uzi'
        '404':
          description: УЗИ не найдено
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /uzi/{id}/echographics:
    get:
      summary: получить эхографику uzi
      tags:
        - uzi

      parameters:
        - name: id
          in: path
          required: true
          description: id узи
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: echographics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/echographics'
        '404':
          description: Эхографическое исследование не найдено
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

    patch:
      summary: обновить эхографику
      tags:
        - uzi

      parameters:
        - name: id
          in: path
          required: true
          description: id узи
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/echographics'
      responses:
        '200':
          description: echographic
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/echographics'
        '404':
          description: Эхографическое исследование не найдено
          $ref: "#/components/responses/error"
        '400':
          description: Неверный формат запроса
          $ref: "#/components/responses/error"
        '422':
          description: Ошибка валидации данных
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /uzi/device:
    post:
      summary: добавить uzi аппарат
      tags:
        - uzi

      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  maxLength: 255
                  description: именование модели узи аппарата
              example:
                name: "Siemens"
      responses:
        '200':
          description: id uzi аппарата
          content:
            application/json:
              schema:
                type: object
                required:
                  - id
                properties:
                  id:
                    type: integer
                    description: id uzi аппарата
              example:
                id: 1
        '400':
          description: Неверный формат запроса
          $ref: "#/components/responses/error"
        '422':
          description: Ошибка валидации данных
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /uzi/devices:
    get:
      summary: получит список uzi апппапапратов
      tags:
        - uzi

      responses:
        '200':
          description: uzi аппараты
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/device"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /uzi/{id}/images:
    get:
      summary: получает списк изображений uzi
      tags:
        - uzi

      parameters:
        - name: id
          in: path
          required: true
          description: id узи
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: images
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/image'
        '404':
          description: УЗИ не найдено
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /uzi/image/{id}/nodes-segments:
    get:
      summary: получит узлы и сегменты на указанном изображении
      tags:
        - uzi

      parameters:
        - name: id
          in: path
          required: true
          description: id изображения
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: узлы и сегменты
          content:
            application/json:
              schema:
                type: object
                properties:
                  nodes:
                    type: array
                    items:
                      $ref: '#/components/schemas/node'
                  segments:
                    type: array
                    items:
                      $ref: '#/components/schemas/segment'
        '404':
          description: Изображение не найдено
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /uzi/{id}/nodes-segments:
    post:
      summary: добавить узел с сегментами
      tags:
        - uzi

      parameters:
        - name: id
          in: path
          required: true
          description: id узи
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - node
                - segments
              properties:
                node:
                  type: object
                  required:
                    - tirads_23
                    - tirads_4
                    - tirads_5
                  properties:
                    tirads_23:
                      type: number
                      maximum: 1.0
                      minimum: 0.0
                    tirads_4:
                      type: number
                      maximum: 1.0
                      minimum: 0.0
                    tirads_5:
                      type: number
                      maximum: 1.0
                      minimum: 0.0
                    description:
                      type: string
                      description: описание узла
                segments:
                  type: array
                  items:
                    type: object
                    required:
                      - image_id
                      - contor
                      - tirads_23
                      - tirads_4
                      - tirads_5
                    properties:
                      image_id:
                        type: string
                        format: uuid
                      contor:
                        $ref: '#/components/schemas/contor'
                      tirads_23:
                        type: number
                        maximum: 1.0
                        minimum: 0.0
                      tirads_4:
                        type: number
                        maximum: 1.0
                        minimum: 0.0
                      tirads_5:
                        type: number
                        maximum: 1.0
                        minimum: 0.0
      responses:
        '200':
          description: id узла
          content:
            application/json:
              schema:
                type: object
                required:
                  - node_id
                  - segment_ids
                properties:
                  node_id:
                    type: string
                    format: uuid
                  segment_ids:
                    type: array
                    items:
                      type: string
                      format: uuid
        '400':
          description: Неверный формат запроса
          $ref: "#/components/responses/error"
        '404':
          description: УЗИ не найдено
          $ref: "#/components/responses/error"
        '422':
          description: Ошибка валидации данных
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /uzi/{id}/nodes:
    get:
      summary: получить все узлы узи
      tags:
        - uzi

      parameters:
        - name: id
          in: path
          required: true
          description: uzi_id
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: id узла
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/node'
        '404':
          description: УЗИ не найдено
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /uzi/nodes/{id}:
    patch:
      summary: обновить узел
      tags:
        - uzi

      parameters:
        - name: id
          in: path
          required: true
          description: id узла
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                validation:
                  type: string
                  enum:
                    - null
                    - invalid
                    - valid
                tirads_23:
                  type: number
                  maximum: 1.0
                  minimum: 0.0
                tirads_4:
                  type: number
                  maximum: 1.0
                  minimum: 0.0
                tirads_5:
                  type: number
                  maximum: 1.0
                  minimum: 0.0
              example:
                validation: "invalid"
                tirads_23: 0.67
                tirads_4: 0.23
                tirads_5: 0.89

      responses:
        '200':
          description: обновленный узел
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/node'
        '400':
          description: Неверный формат запроса
          $ref: "#/components/responses/error"
        '404':
          description: Узел не найден
          $ref: "#/components/responses/error"
        '422':
          description: Ошибка валидации данных
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

    delete:
      summary: удалить узел
      description: сегменты узла будут также удалены
      tags:
        - uzi

      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: узел удален
        '404':
          description: Узел не найден
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /uzi/nodes/{id}/segments:
    get:
      summary: получить сегменты узла
      tags:
        - uzi

      parameters:
        - name: id
          in: path
          required: true
          description: id узла
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: сегменты узла
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/segment'
        '404':
          description: Узел не найден
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /uzi/segment:
    post:
      summary: добавить новый сегмент
      tags:
        - uzi

      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - image_id
                - node_id
                - contor
                - tirads_23
                - tirads_4
                - tirads_5
              properties:
                image_id:
                  type: string
                  format: uuid
                node_id:
                  type: string
                  format: uuid
                contor:
                  $ref: '#/components/schemas/contor'
                tirads_23:
                  type: number
                  maximum: 1.0
                  minimum: 0.0
                tirads_4:
                  type: number
                  maximum: 1.0
                  minimum: 0.0
                tirads_5:
                  type: number
                  maximum: 1.0
                  minimum: 0.0
      responses:
        '200':
          description: id сегмента
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/simpleUuid"
        '400':
          description: Неверный формат запроса
          $ref: "#/components/responses/error"
        '404':
          description: Изображение или узел не найдены
          $ref: "#/components/responses/error"
        '422':
          description: Ошибка валидации данных
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /uzi/segment/{id}:
    patch:
      summary: обновить сегмент
      tags:
        - uzi

      parameters:
        - name: id
          in: path
          required: true
          description: id сегмента
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                contor:
                  $ref: '#/components/schemas/contor'
                tirads_23:
                  type: number
                  maximum: 1.0
                  minimum: 0.0
                tirads_4:
                  type: number
                  maximum: 1.0
                  minimum: 0.0
                tirads_5:
                  type: number
                  maximum: 1.0
                  minimum: 0.0
              example:
                contor:
                  - x: 100
                    y: 100
                  - x: 200
                    y: 200
                tirads_23: 0.67
                tirads_4: 0.23
                tirads_5: 0.89
      responses:
        '200':
          description: обновленный узел
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/segment'
        '400':
          description: Неверный формат запроса
          $ref: "#/components/responses/error"
        '404':
          description: Сегмент не найден
          $ref: "#/components/responses/error"
        '422':
          description: Ошибка валидации данных
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

    delete:
      summary: удалить сегмент
      description: если у узла не останется сегментов, он будет **удален**
      tags:
        - uzi

      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: сегмент удален
        '404':
          description: Сегмент не найден
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /download/{uzi_id}/{image_id}:
    get:
      summary: получить кадр узи
      tags:
        - download

      parameters:
        - name: uzi_id
          in: path
          required: true
          description: id узи
          schema:
            type: string
            format: uuid
        - name: image_id
          in: path
          required: true
          description: id кадра
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: кадр узи
          content:
            image/png:
              schema:
                type: string
                format: binary
        '500':
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /download/cytology/{cytology_id}/{original_image_id}:
    get:
      summary: получить оригинальное изображение цитологического исследования
      tags:
        - download
      parameters:
        - name: cytology_id
          in: path
          required: true
          description: id цитологического исследования
          schema:
            type: string
            format: uuid
        - name: original_image_id
          in: path
          required: true
          description: id оригинального изображения
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: оригинальное изображение
          content:
            image/png:
              schema:
                type: string
                format: binary
            image/jpeg:
              schema:
                type: string
                format: binary
            application/octet-stream:
              schema:
                type: string
                format: binary
        '404':
          description: Изображение не найдено
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /tiler/dzi/{file_path}:
    get:
      operationId: TilerDziFilePathGet
      summary: Получить DZI XML метаданные для изображения
      tags:
        - tiler
      parameters:
        - name: file_path
          in: path
          required: true
          description: путь к файлу изображения
          schema:
            type: string
      responses:
        '200':
          description: DZI XML метаданные
          content:
            application/xml:
              schema:
                type: string
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /tiler/dzi/{file_path}/files/{level}/{col}_{row}.{format}:
    get:
      operationId: TilerDziFilePathFilesLevelColRowFormatGet
      summary: Получить тайл изображения
      tags:
        - tiler
      parameters:
        - name: file_path
          in: path
          required: true
          description: путь к файлу изображения
          schema:
            type: string
        - name: level
          in: path
          required: true
          description: уровень масштабирования (0 - оригинальное изображение)
          schema:
            type: integer
            minimum: 0
        - name: col
          in: path
          required: true
          description: номер колонки тайла
          schema:
            type: integer
            minimum: 0
        - name: row
          in: path
          required: true
          description: номер строки тайла
          schema:
            type: integer
            minimum: 0
        - name: format
          in: path
          required: true
          description: формат изображения
          schema:
            type: string
            enum:
              - jpeg
              - jpg
              - png
      responses:
        '200':
          description: тайл изображения
          content:
            image/jpeg:
              schema:
                type: string
                format: binary
            image/png:
              schema:
                type: string
                format: binary
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /tariff_plans/{id}:
    get:
      summary: Получить тарифный план по ID
      tags:
        - Tariff Plans
      parameters:
        - name: id
          in: path
          required: true
          description: Идентификатор тарифного плана
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Успешный ответ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TariffPlan'
        '500':
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /tariff_plans:
    get:
      summary: Получить список всех тарифных планов
      tags:
        - Tariff Plans
      responses:
        '200':
          description: Успешный ответ
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TariffPlan'
        '500':
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /subscriptions/purchase:
    post:
      summary: Купить подписку
      tags:
        - Subscriptions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PurchaseSubscriptionRequest'
      responses:
        '200':
          description: Успешный ответ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PurchaseSubscriptionResponse'
        '500':
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /subscriptions/check-active:
    get:
      summary: Проверить наличие активной подписки у текущего пользователя
      tags:
        - Subscriptions
      responses:
        '200':
          description: Успешный ответ
          content:
            application/json:
              schema:
                type: object
                properties:
                  has_active_subscription:
                    type: boolean
        '500':
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /subscriptions/get-active:
    get:
      summary: Получить информацию об активной подписке текущего пользователя
      tags:
        - Subscriptions
      responses:
        '200':
          description: Успешный ответ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'
        '404':
          $ref: "#/components/responses/error"
        '500':
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /payment_providers:
    get:
      summary: Получить список всех платежных провайдеров
      tags:
        - Payment Providers
      responses:
        '200':
          description: Успешный ответ
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PaymentProvider'
        '500':
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /yookassa/webhooks:
    post:
      summary: Обработка уведомлений от Юкассы
      tags:
        - Webhooks
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/YookassaWebhookRequest'
      responses:
        '200':
          description: Успешная обработка уведомления
        '500':
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /cytology/create:
    post:
      operationId: CytologyCreateCreate
      summary: Форма для сохранния цитологического изображения
      tags:
        - cytology
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - diagnostic_number
              properties:
                image:
                  type: string
                  format: binary
                  description: файл изображения цитологии
                diagnostic_number:
                  type: integer
                  minimum: 0
                  maximum: 2147483647
                  description: Номер диагностики
                diagnostic_marking:
                  type: string
                  enum:
                    - П11
                    - Л23
                  description: Маркировка диагностики
                material_type:
                  type: string
                  enum:
                    - GS
                    - BP
                    - TP
                    - PTP
                    - LNP
                calcitonin:
                  type: integer
                  minimum: -2147483648
                  maximum: 2147483647
                calcitonin_in_flush:
                  type: integer
                  minimum: -2147483648
                  maximum: 2147483647
                thyroglobulin:
                  type: integer
                  minimum: -2147483648
                  maximum: 2147483647
                prev:
                  type: integer
                  readOnly: true
                  x-nullable: true
                parent_prev:
                  type: integer
                  readOnly: true
                  x-nullable: true
                patient_card:
                  type: integer
                  x-nullable: true
                details:
                  type: string
                  description: Детали диагностики в формате JSON
                  x-nullable: true
                is_last:
                  type: boolean
                  readOnly: true
                  description: Является ли данная версия измениний последней?
                diagnos_date:
                  type: string
                  format: date-time
                  readOnly: true
      responses:
        '201':
          description: созданное цитологическое исследование
          content:
            application/json:
              schema:
                type: object
                required:
                  - diagnostic_number
                properties:
                  id:
                    type: string
                    format: uuid
                    readOnly: true
                  image:
                    type: string
                    format: uri
                    readOnly: true
                  is_last:
                    type: boolean
                    readOnly: true
                  diagnos_date:
                    type: string
                    format: date-time
                    readOnly: true
                  details:
                    type: object
                    x-nullable: true
                  diagnostic_marking:
                    type: string
                    enum:
                      - П11
                      - Л23
                  diagnostic_number:
                    type: integer
                  material_type:
                    type: string
                    enum:
                      - GS
                      - BP
                      - TP
                      - PTP
                      - LNP
                  calcitonin:
                    type: integer
                  calcitonin_in_flush:
                    type: integer
                  thyroglobulin:
                    type: integer
                  prev:
                    type: integer
                    readOnly: true
                    x-nullable: true
                  parent_prev:
                    type: integer
                    readOnly: true
                    x-nullable: true
                  patient_card:
                    type: integer
                    x-nullable: true
        '400':
          description: Неверный формат запроса
          $ref: "#/components/responses/error"
        '422':
          description: Ошибка валидации данных
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /cytology/{id}:
    get:
      operationId: CytologyRead
      summary: Информация об одной группе снимков
      tags:
        - cytology
      parameters:
        - name: id
          in: path
          required: true
          description: id цитологического исследования
          schema:
            type: string
      responses:
        '200':
          description: цитологическое исследование
          content:
            application/json:
              schema:
                type: object
                required:
                  - original_image
                  - info
                properties:
                  original_image:
                    type: object
                    properties:
                      id:
                        type: integer
                        readOnly: true
                      create_date:
                        type: string
                        format: date-time
                      delay_time:
                        type: number
                      viewed_flag:
                        type: boolean
                      image:
                        type: string
                        format: uri
                        readOnly: true
                  info:
                    type: object
                    required:
                      - patient
                      - patient_card
                      - image_group
                    properties:
                      patient:
                        $ref: '#/components/schemas/patient'
                      patient_card:
                        $ref: '#/components/schemas/patientCard'
                      image_group:
                        type: object
                        required:
                          - diagnostic_number
                        properties:
                          id:
                            type: integer
                            readOnly: true
                          is_last:
                            type: boolean
                          diagnos_date:
                            type: string
                            format: date-time
                            readOnly: true
                          details:
                            type: object
                            x-nullable: true
                          diagnostic_marking:
                            type: string
                            enum:
                              - П11
                              - Л23
                          diagnostic_number:
                            type: integer
                          material_type:
                            type: string
                            enum:
                              - GS
                              - BP
                              - TP
                              - PTP
                              - LNP
                          calcitonin:
                            type: integer
                          calcitonin_in_flush:
                            type: integer
                          thyroglobulin:
                            type: integer
                          prev:
                            type: integer
                            x-nullable: true
                          parent_prev:
                            type: integer
                            x-nullable: true
                          original_image:
                            type: integer
                            x-nullable: true
        '404':
          description: Цитологическое исследование не найдено
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /cytology/{id}/segments:
    get:
      operationId: CytologySegmentsList
      summary: Информация об одной группе снимков
      tags:
        - cytology
      parameters:
        - name: id
          in: path
          required: true
          description: id цитологического исследования
          schema:
            type: string
        - name: is_ai
          in: query
          required: false
          description: is_ai
          schema:
            type: string
        - name: group_type
          in: query
          required: false
          description: group_type
          schema:
            type: string
            enum:
              - CE
              - CL
              - ME
        - name: seg_type
          in: query
          required: false
          description: seg_type
          schema:
            type: string
            enum:
              - NIL
              - NIR
              - NIM
              - CNO
              - CGE
              - C2N
              - CPS
              - CFC
              - CLY
              - SOS
              - SDS
              - SMS
              - STS
              - SPS
              - SNM
              - STM
        - name: limit
          in: query
          required: false
          description: Number of results to return per page.
          schema:
            type: integer
        - name: offset
          in: query
          required: false
          description: The initial index from which to return the results.
          schema:
            type: integer
      responses:
        '200':
          description: сегменты цитологического исследования
          content:
            application/json:
              schema:
                type: object
                required:
                  - count
                  - results
                properties:
                  count:
                    type: integer
                  next:
                    type: string
                    format: uri
                    x-nullable: true
                  previous:
                    type: string
                    format: uri
                    x-nullable: true
                  results:
                    type: array
                    items:
                      type: object
                      required:
                        - data
                      properties:
                        id:
                          type: integer
                          readOnly: true
                        data:
                          type: array
                          items:
                            type: object
                            required:
                              - points
                            properties:
                              id:
                                type: integer
                                readOnly: true
                              points:
                                type: array
                                items:
                                  type: object
                                  required:
                                    - uid
                                    - x
                                    - y
                                  properties:
                                    id:
                                      type: integer
                                      readOnly: true
                                    uid:
                                      type: integer
                                    x:
                                      type: integer
                                    y:
                                      type: integer
                              details:
                                type: string
                                readOnly: true
                        group_type:
                          type: string
                          enum:
                            - CE
                            - CL
                            - ME
                        seg_type:
                          type: string
                          enum:
                            - NIL
                            - NIR
                            - NIM
                            - CNO
                            - CGE
                            - C2N
                            - CPS
                            - CFC
                            - CLY
                            - SOS
                            - SDS
                            - SMS
                            - STS
                            - SPS
                            - SNM
                            - STM
                        details:
                          type: object
                          x-nullable: true
                        is_ai:
                          type: boolean
        '404':
          description: Цитологическое исследование не найдено
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /cytology/{id}/update:
    put:
      operationId: CytologyUpdateUpdate
      summary: Обновление всей страницы с информацией о приеме
      tags:
        - cytology
      parameters:
        - name: id
          in: path
          required: true
          description: id цитологического исследования
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - patient_card
                - diagnostic_number
              properties:
                id:
                  type: integer
                  readOnly: true
                patient_card:
                  type: object
                  properties:
                    patient:
                      type: integer
                    acceptance_datetime:
                      type: string
                      format: date-time
                      readOnly: true
                    diagnosis:
                      type: string
                details:
                  type: object
                  required:
                    - diagnostic_number
                  properties:
                    id:
                      type: integer
                      readOnly: true
                    is_last:
                      type: boolean
                    diagnos_date:
                      type: string
                      format: date-time
                      readOnly: true
                    diagnostic_marking:
                      type: string
                      enum:
                        - П11
                        - Л23
                    diagnostic_number:
                      type: integer
                    material_type:
                      type: string
                      enum:
                        - GS
                        - BP
                        - TP
                        - PTP
                        - LNP
                    calcitonin:
                      type: integer
                    calcitonin_in_flush:
                      type: integer
                    thyroglobulin:
                      type: integer
                    prev:
                      type: integer
                      x-nullable: true
                    parent_prev:
                      type: integer
                      x-nullable: true
                    patient_card:
                      type: integer
                      x-nullable: true
                    original_image:
                      type: integer
                      x-nullable: true
                is_last:
                  type: boolean
                diagnos_date:
                  type: string
                  format: date-time
                  readOnly: true
                diagnostic_marking:
                  type: string
                  enum:
                    - П11
                    - Л23
                diagnostic_number:
                  type: integer
                material_type:
                  type: string
                  enum:
                    - GS
                    - BP
                    - TP
                    - PTP
                    - LNP
                calcitonin:
                  type: integer
                calcitonin_in_flush:
                  type: integer
                thyroglobulin:
                  type: integer
                prev:
                  type: integer
                  x-nullable: true
                parent_prev:
                  type: integer
                  x-nullable: true
                original_image:
                  type: integer
      responses:
        '200':
          description: обновленное цитологическое исследование
          content:
            application/json:
              schema:
                type: object
                required:
                  - patient_card
                  - diagnostic_number
                properties:
                  id:
                    type: integer
                    readOnly: true
                  patient_card:
                    type: object
                  details:
                    type: object
                  is_last:
                    type: boolean
                  diagnos_date:
                    type: string
                    format: date-time
                    readOnly: true
                  diagnostic_marking:
                    type: string
                  diagnostic_number:
                    type: integer
                  material_type:
                    type: string
                  calcitonin:
                    type: integer
                  calcitonin_in_flush:
                    type: integer
                  thyroglobulin:
                    type: integer
                  prev:
                    type: integer
                    x-nullable: true
                  parent_prev:
                    type: integer
                    x-nullable: true
                  original_image:
                    type: integer
        '404':
          description: Цитологическое исследование не найдено
          $ref: "#/components/responses/error"
        '400':
          description: Неверный формат запроса
          $ref: "#/components/responses/error"
        '422':
          description: Ошибка валидации данных
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"
    patch:
      operationId: CytologyUpdatePartialUpdate
      summary: Обновление всей страницы с информацией о приеме
      tags:
        - cytology
      parameters:
        - name: id
          in: path
          required: true
          description: id цитологического исследования
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - patient_card
                - diagnostic_number
              properties:
                id:
                  type: integer
                  readOnly: true
                patient_card:
                  type: object
                  properties:
                    patient:
                      type: integer
                    acceptance_datetime:
                      type: string
                      format: date-time
                      readOnly: true
                    diagnosis:
                      type: string
                details:
                  type: object
                is_last:
                  type: boolean
                diagnos_date:
                  type: string
                  format: date-time
                  readOnly: true
                diagnostic_marking:
                  type: string
                  enum:
                    - П11
                    - Л23
                diagnostic_number:
                  type: integer
                material_type:
                  type: string
                  enum:
                    - GS
                    - BP
                    - TP
                    - PTP
                    - LNP
                calcitonin:
                  type: integer
                calcitonin_in_flush:
                  type: integer
                thyroglobulin:
                  type: integer
                prev:
                  type: integer
                  x-nullable: true
                parent_prev:
                  type: integer
                  x-nullable: true
                original_image:
                  type: integer
      responses:
        '200':
          description: обновленное цитологическое исследование
          content:
            application/json:
              schema:
                type: object
                required:
                  - patient_card
                  - diagnostic_number
                properties:
                  id:
                    type: integer
                    readOnly: true
                  patient_card:
                    type: object
                  details:
                    type: object
                  is_last:
                    type: boolean
                  diagnos_date:
                    type: string
                    format: date-time
                    readOnly: true
                  diagnostic_marking:
                    type: string
                  diagnostic_number:
                    type: integer
                  material_type:
                    type: string
                  calcitonin:
                    type: integer
                  calcitonin_in_flush:
                    type: integer
                  thyroglobulin:
                    type: integer
                  prev:
                    type: integer
                    x-nullable: true
                  parent_prev:
                    type: integer
                    x-nullable: true
                  original_image:
                    type: integer
        '404':
          description: Цитологическое исследование не найдено
          $ref: "#/components/responses/error"
        '400':
          description: Неверный формат запроса
          $ref: "#/components/responses/error"
        '422':
          description: Ошибка валидации данных
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /cytology/copy:
    post:
      operationId: CytologyCopyCreate
      summary: Создание нового исследования, на основе предыдущего
      tags:
        - cytology
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                pk:
                  type: integer
                  readOnly: true
                id:
                  type: integer
                  readOnly: true
      responses:
        '201':
          description: скопированное цитологическое исследование
          content:
            application/json:
              schema:
                type: object
                properties:
                  pk:
                    type: integer
                    readOnly: true
                  id:
                    type: integer
                    readOnly: true
        '400':
          description: Неверный формат запроса
          $ref: "#/components/responses/error"
        '404':
          description: Цитологическое исследование не найдено
          $ref: "#/components/responses/error"
        '422':
          description: Ошибка валидации данных
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /cytology/history/{id}:
    get:
      operationId: CytologyHistoryRead
      summary: получить историю цитологического исследования
      tags:
        - cytology
      parameters:
        - name: id
          in: path
          required: true
          description: id цитологического исследования
          schema:
            type: string
            format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        - name: limit
          in: query
          required: false
          description: Number of results to return per page.
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
          example: 10
        - name: offset
          in: query
          required: false
          description: The initial index from which to return the results.
          schema:
            type: integer
            default: 0
            minimum: 0
          example: 0
      responses:
        '200':
          description: история цитологического исследования
          content:
            application/json:
              schema:
                type: object
                required:
                  - count
                  - results
                properties:
                  count:
                    type: integer
                  next:
                    type: string
                    format: uri
                    x-nullable: true
                  previous:
                    type: string
                    format: uri
                    x-nullable: true
                  results:
                    type: array
                    items:
                      type: object
                      required:
                        - diagnostic_number
                      properties:
                        id:
                          type: integer
                          readOnly: true
                        is_last:
                          type: boolean
                        diagnos_date:
                          type: string
                          format: date-time
                          readOnly: true
                        details:
                          type: object
                          x-nullable: true
                        diagnostic_marking:
                          type: string
                          enum:
                            - П11
                            - Л23
                        diagnostic_number:
                          type: integer
                        material_type:
                          type: string
                          enum:
                            - GS
                            - BP
                            - TP
                            - PTP
                            - LNP
                        calcitonin:
                          type: integer
                        calcitonin_in_flush:
                          type: integer
                        thyroglobulin:
                          type: integer
                        prev:
                          type: integer
                          x-nullable: true
                        parent_prev:
                          type: integer
                          x-nullable: true
                        patient_card:
                          type: integer
                          x-nullable: true
                        original_image:
                          type: integer
                          x-nullable: true
              examples:
                example1:
                  summary: Пример успешного ответа с историей исследований
                  value:
                    count: 3
                    next: null
                    previous: null
                    results:
                      - id: 1
                        diagnostic_number: 12345
                        is_last: true
                        diagnos_date: "2024-12-21T10:30:00Z"
                        diagnostic_marking: "П11"
                        material_type: "GS"
                        calcitonin: 5
                        calcitonin_in_flush: 2
                        thyroglobulin: 10
                        prev: null
                        parent_prev: null
                        patient_card: 100
                        original_image: 200
                        details:
                          note: "Первичное исследование"
                      - id: 2
                        diagnostic_number: 12344
                        is_last: false
                        diagnos_date: "2024-12-20T14:20:00Z"
                        diagnostic_marking: "Л23"
                        material_type: "BP"
                        calcitonin: 3
                        calcitonin_in_flush: 1
                        thyroglobulin: 8
                        prev: 1
                        parent_prev: null
                        patient_card: 100
                        original_image: 199
                        details:
                          note: "Повторное исследование"
                      - id: 3
                        diagnostic_number: 12343
                        is_last: false
                        diagnos_date: "2024-12-19T09:15:00Z"
                        diagnostic_marking: "П11"
                        material_type: "TP"
                        calcitonin: 4
                        calcitonin_in_flush: 2
                        thyroglobulin: 9
                        prev: 2
                        parent_prev: null
                        patient_card: 100
                        original_image: 198
                        details: null
        '404':
          description: Цитологическое исследование не найдено
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /cytology/segment/group/create/{cytology_img_id}:
    post:
      operationId: CytologySegmentGroupCreateCreate
      summary: создать группу сегментаций
      tags:
        - cytology
      parameters:
        - name: cytology_img_id
          in: path
          required: true
          description: id цитологического исследования
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
                - seg_type
              properties:
                data:
                  type: object
                  required:
                    - points
                  properties:
                    points:
                      type: array
                      items:
                        type: object
                        required:
                          - x
                          - y
                        properties:
                          x:
                            type: integer
                            minimum: 0
                          y:
                            type: integer
                            minimum: 0
                seg_type:
                  type: string
                  enum:
                    - NIL
                    - NIR
                    - NIM
                    - CNO
                    - CGE
                    - C2N
                    - CPS
                    - CFC
                    - CLY
                    - SOS
                    - SDS
                    - SMS
                    - STS
                    - SPS
                    - SNM
                    - STM
      responses:
        '201':
          description: созданная группа сегментаций
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    readOnly: true
                  data:
                    type: object
                    required:
                      - points
                    properties:
                      points:
                        type: array
                        items:
                          type: object
                          required:
                            - x
                            - y
                          properties:
                            x:
                              type: integer
                            y:
                              type: integer
                  seg_type:
                    type: string
        '400':
          description: Неверный формат запроса
          $ref: "#/components/responses/error"
        '404':
          description: Цитологическое исследование не найдено
          $ref: "#/components/responses/error"
        '422':
          description: Ошибка валидации данных
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"

  /cytology/segment/update/{id}:
    get:
      operationId: CytologySegmentUpdateRead
      summary: получить сегментацию
      tags:
        - cytology
      parameters:
        - name: id
          in: path
          required: true
          description: id сегментации
          schema:
            type: integer
      responses:
        '200':
          description: сегментация
          content:
            application/json:
              schema:
                type: object
                required:
                  - points
                properties:
                  points:
                    type: array
                    items:
                      type: object
                      required:
                        - x
                        - y
                      properties:
                        x:
                          type: integer
                        y:
                          type: integer
                  segment_group:
                    type: integer
        '404':
          description: Сегментация не найдена
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"
    put:
      operationId: CytologySegmentUpdateUpdate
      summary: обновить сегментацию
      tags:
        - cytology
      parameters:
        - name: id
          in: path
          required: true
          description: id сегментации
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - points
              properties:
                points:
                  type: array
                  items:
                    type: object
                    required:
                      - x
                      - y
                    properties:
                      x:
                        type: integer
                        minimum: 0
                      y:
                        type: integer
                        minimum: 0
                segment_group:
                  type: integer
      responses:
        '200':
          description: обновленная сегментация
          content:
            application/json:
              schema:
                type: object
                required:
                  - points
                properties:
                  points:
                    type: array
                    items:
                      type: object
                      required:
                        - x
                        - y
                      properties:
                        x:
                          type: integer
                        y:
                          type: integer
                  segment_group:
                    type: integer
        '404':
          description: Сегментация не найдена
          $ref: "#/components/responses/error"
        '400':
          description: Неверный формат запроса
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"
    patch:
      operationId: CytologySegmentUpdatePartialUpdate
      summary: обновить сегментацию
      tags:
        - cytology
      parameters:
        - name: id
          in: path
          required: true
          description: id сегментации
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - points
              properties:
                points:
                  type: array
                  items:
                    type: object
                    required:
                      - x
                      - y
                    properties:
                      x:
                        type: integer
                        minimum: 0
                      y:
                        type: integer
                        minimum: 0
                segment_group:
                  type: integer
      responses:
        '200':
          description: обновленная сегментация
          content:
            application/json:
              schema:
                type: object
                required:
                  - points
                properties:
                  points:
                    type: array
                    items:
                      type: object
                      required:
                        - x
                        - y
                      properties:
                        x:
                          type: integer
                        y:
                          type: integer
                  segment_group:
                    type: integer
        '404':
          description: Сегментация не найдена
          $ref: "#/components/responses/error"
        '400':
          description: Неверный формат запроса
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"
    delete:
      operationId: CytologySegmentUpdateDelete
      summary: удалить сегментацию
      tags:
        - cytology
      parameters:
        - name: id
          in: path
          required: true
          description: id сегментации
          schema:
            type: integer
      responses:
        '204':
          description: сегментация удалена
        '404':
          description: Сегментация не найдена
          $ref: "#/components/responses/error"
        '500':
          description: Внутренняя ошибка сервера
          $ref: "#/components/responses/error"
        default:
          $ref: "#/components/responses/error"
